<main class="invoice">
  <h1>Créer une facture de taxe de séjour pour meublé de tourisme</h1>
  <section class="calcul">
    <%= simple_form_for :taxe_sejour, :url => taxe_facture_path, :method => :post do |f| %>
      <%= f.input :town, collection: [ "Niederbronn", "Morsbronn" ], selected: "Niederbronn", required: false, label: "Communauté de commune" %>
      <%= f.input :rating, :input_html => { :type => "string" }, collection: [ "non classé", "1", "2", "3", "4", "5" ], selected: "Niederbronn", required: false, label: "Classement en étoile" %>
      <%= f.input :amount, :input_html => { :type => "number" }, label: "Montant total du séjour :", :required => false %>
      <%= f.input :days, :input_html => { :type => "number" }, label: "Durée du séjour :", :required => false %>
      <%= f.input :people, :input_html => { :type => "number" }, label: "Total personnes :", :required => false %>
      <%= f.input :minors, :input_html => { :type => "number" }, label: "Pers. non assujetties (ex: mineurs) :", :required => false %>
      <div class="inline">
        <%= f.text_field :option1, :required => false, placeholder: "Option 1, ex: location de draps", class: "option" %>
        <%= f.input :tarif1, label: false, :required => false, :input_html => { :type => "number" } %>
      </div>
      <div class="inline">
        <%= f.text_field :option2, :required => false, placeholder: "Option 2, ex: petits déjeuner", class: "option" %>
        <%= f.input :tarif2, label: false, :required => false, :input_html => { :type => "number" } %>
      </div>
      <%= f.button :submit, value: "Calculer" %>
      <h2>Créer une facture de taxe de séjour | 2019</h2>
    <% end  %>
  </section>

  <% if @taxe != "0.0" && !@taxe.nil? %>

  <section id="taxe-invoice">
    <div id="facture">
      <h2>Facture</h2>
      <div class="details">
        <div>
          <p>Montant du séjour :</p><p><%= sprintf("%.2f",@amount.to_f) %> €</p>
        </div>
        <% if !@options.nil? %>
          <div class="options-list">
            <p>Options lors du séjour:</p>
            <ul>
              <% @options.each do |key, value| %>
                <li><%= key.capitalize %>: <%= sprintf("%.2f",value.to_f) %> €</li>
              <% end %>
            </ul>
          </div>
        <% end %>
        <div>
          <p>Nombre de nuitées :</p><p><%= @days %></p>
        </div>
        <div>
          <p>Total de personnes :</p><p><%= @people %></p>
        </div>

        <% if @minors.to_f == 0 %>
        <% else %>
          <div>
            <p>Nombre de pers. exonérées (ex: pers. mineures) :</p><p><%= @minors.to_i %></p>
          </div>
        <% end %>

        <div>
          <p>Taxe par personne (dont taxe dep. de 10%) :</p><p><%= sprintf("%.2f",@single_tax) %> €</p>
        </div>
        <div>
          <p>Détail du calcul : <%= @single_tax %> € x <%= @people.to_i - @minors.to_i %> (pers. assujetties) x <%= @days %> (jours)</p>
        </div>
        <div class="amount-taxe">
          <p>Montant total de la taxe de séjour à verser :</p><p><b><%= sprintf("%.2f", @taxe.to_f) %> €</b></p>
        </div>
        <%= link_to 'Imprimer', 'your_link_here', :onclick => 'window.print();return false;', class: '' %>
      </div>
    </div>
  </section>
  <% else %>
  <% end %>
</main>
<%= javascript_pack_tag "taxes" %>
